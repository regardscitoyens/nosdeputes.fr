#!/bin/bash

loi=$1
lockfile=/tmp/loading_amdts_$loi

if test -e "$lockfile"; then
  exit
fi
touch "$lockfile"

cd /home/nossenateurs/prod

# Récupération et création des JSON

#echo Amendements
#echo =======================
cd batch/amendements ; bash compute_latest_loi.sh $loi ; cd ../..

# Chargement via tasks

#echo Load Amendements
#echo =======================
while ls batch/amendements/json | grep [a-z] > /dev/null ; do
        php symfony cc --env=test  --app=frontend > /dev/null
        php symfony load:Amdmts 2>&1 | grep -v "sujet missing" 
done;

rm "$lockfile"

